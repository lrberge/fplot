<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>fplot walkthrough • fplot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="fplot walkthrough">
<meta property="og:description" content="fplot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Exporting_graphs.html">Exporting graphs</a>
    </li>
    <li>
      <a href="../articles/fplot_walkthrough.html">fplot walkthrough</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>fplot walkthrough</h1>
                        <h4 data-toc-skip class="author">Laurent
Berge</h4>
            
            <h4 data-toc-skip class="date">2023-08-22</h4>
      
      
      <div class="hidden name"><code>fplot_walkthrough.Rmd</code></div>

    </div>

    
    
<!-- output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: false -->
<!-- fontsize: 12pt
output:
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true -->
<p><code>fplot</code> plots of distributions, automatically adjusting
the parameters for the user. The syntax uses formulas, allowing
conditional/weighted distributions with minimum efforts. The many
arguments are automatically adjusted to provide the most meaningful (and
hopefully beautiful!) graphs depending on the data at hand.</p>
<p>Although the core of the package concerns distributions,
<code>fplot</code> also offers functions to plot trends (possibly
conditional) and conditional boxplots.</p>
<p>Since the main purpose of this package is to provide graphs ready for
publications, you can globally relabel all the variables to be displayed
with <code>setFplot_dict</code>. In this vignette this is done once:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setFplot_dict.html">setFplot_dict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Origin <span class="op">=</span> <span class="st">"Exporting Country"</span>, Destination <span class="op">=</span> <span class="st">"Importing Country"</span>, Euros <span class="op">=</span> <span class="st">"Exports Value in €"</span>, jnl_top_25p <span class="op">=</span> <span class="st">"Pub. in Top 25% journal"</span>, jnl_top_5p <span class="op">=</span> <span class="st">"Publications in Top 5% journal"</span>, journal <span class="op">=</span> <span class="st">"Journal"</span>, institution <span class="op">=</span> <span class="st">"U.S. Institution"</span>, Petal.Length <span class="op">=</span> <span class="st">"Petal Length"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="distributions">Distributions<a class="anchor" aria-label="anchor" href="#distributions"></a>
</h2>
<p>The function <code>plot_distr</code> plots distributions. The syntax
of the function <code>plot_distr</code> is as follows:</p>
<p><code>plot_distr(weight(s) ~ variable | moderator, data)</code></p>
<p>This function is extremely versatile: its default behavior totally
depends on the data it deals with.</p>
<div class="section level3">
<h3 id="categorical-data">Categorical data<a class="anchor" aria-label="anchor" href="#categorical-data"></a>
</h3>
<p>We will use data on publications extracted from the Microsoft
Academic Graph.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">fplot</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">us_pub_econ</span>, package <span class="op">=</span> <span class="st">"fplot"</span><span class="op">)</span></span></code></pre></div>
<p>This data corresponds to publications from U.S. institution in the
field of economics in the period 1985-1990. Here is a sample of the
data:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="8%">
<col width="4%">
<col width="30%">
<col width="36%">
<col width="10%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="right">paper_id</th>
<th align="right">year</th>
<th align="left">institution</th>
<th align="left">journal</th>
<th align="right">jnl_top_25p</th>
<th align="right">jnl_top_5p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">865948</td>
<td align="right">1988</td>
<td align="left">university of california berkeley</td>
<td align="left">university of san francisco law review</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2027349</td>
<td align="right">1990</td>
<td align="left">university of wisconsin madison</td>
<td align="left">climatic change</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">2299436</td>
<td align="right">1988</td>
<td align="left">columbia university</td>
<td align="left">marine resource economics</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2558483</td>
<td align="right">1988</td>
<td align="left">yale university</td>
<td align="left">journal of accounting auditing &amp; finance</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">2672463</td>
<td align="right">1989</td>
<td align="left">university of michigan</td>
<td align="left">administration in social work</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2860349</td>
<td align="right">1985</td>
<td align="left">university of kansas</td>
<td align="left">administration in social work</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>What’s the distribution of publications per institutions?</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># When there is only one variable, you can use a vector</span></span>
<span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">us_pub_econ</span><span class="op">$</span><span class="va">institution</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>What can we remark? First only the first 15 most important
institutions are plotted. Indeed, since the institution variable is a
categorical data, plotting all the 444 different would have just
cluttered the graph and nothing could have been visible. We can increase
the number of bars plotted with argument <code>nbins</code>.</p>
<p>Although only the first are plotted, we still have information on the
institutions left with the last (broken) bar reporting the number of
publications that are left. We can avoid displaying this column with the
argument <code>other = FALSE</code>.</p>
<p>We can also notice that not only the graph of the distribution is
shown, but the number of observations is reported on the top of each bar
to have a quick insight of the total numbers. Further, the size of the
numbers always fit the width of the bars. The argument <code>top</code>
manages the information displayed on the top of the bars: it can be
numbers (<code>top = "nb"</code>), fractions
(<code>top = "frac"</code>), or nothing (<code>top = "none"</code>). The
default depends on the type of data.</p>
<p>Finally, the labels in the x-axis: i) all appear and ii) are
truncated meaningfully. Since the institution variable is categorical,
there is no way to deduce which institution each bar represent if it is
not displayed explicitly. They are further truncated at 20 characters
(argument <code>trunc</code>) and the truncation method tries to keep
the most information from the labels
(<code>trunc.method = "auto"</code>). But there are other truncation
methods, like trimming the right (resp. the middle) of the label with
<code>trunc.method = "right"</code> (resp.
<code>trunc.method = "mid"</code>). To display horizontal labels
instead, you can use <code>labels.tilted = FALSE</code>.</p>
<p>Now let’s weight the production of the institutions by the quality of
the journals:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">jnl_top_5p</span> <span class="op">~</span> <span class="va">institution</span>, <span class="va">us_pub_econ</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>We added the weight directly in the left-hand-side of the formula.
Notice that now Harvard ranks 1st (it was 3rd when not weighting by
quality).</p>
<p>We can add several weights at the same time:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">jnl_top_25p</span> <span class="op">+</span> <span class="va">jnl_top_5p</span> <span class="op">~</span> <span class="va">institution</span>, <span class="va">us_pub_econ</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>As we can see, the more we weight by quality, the more the
distribution is skewed towards the top institutions.</p>
<p>Now we illustrate the conditional graphs by asking the question of
what are the journals in which the 3 most productive institutions
publish.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="op">~</span> <span class="va">journal</span> <span class="op">|</span> <span class="va">institution</span>, <span class="va">us_pub_econ</span><span class="op">)</span></span>
<span><span class="co">#&gt; The 3 moderators were chosen based on frequency.</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>What happened? In the x-axis, the journals are displayed since they
are the “variable”, and since we added the institution as a moderator,
the data is broken down across each institution. But not all the 444
institutions are shown: by default only the three moderator values (here
institutions) that appear the most are reported. When there is an
automatic selection, a message is also prompted. The user can increase
the number of moderator values reported with the argument
<code>mod.select</code>, or provide the specific values to be shown.</p>
<p>The 7 most important journals are displayed for each institution and
the scale corresponds to the share of the journal within the
institution. Instead of displaying the within share, the total share
could have been displayed with the option <code>total = TRUE</code>.</p>
<p>Here the numbers on the top of the bars come handy to provide
comparisons across institutions. Importantly, because the journal names
are long, it would have been impossible to display them in a standard
way. As we can see, they are first truncated (meaningfully) and then
tilted. in the end, the graph is fully informative.</p>
<p>By default, when the data is split, the bar containing the “other”
information is not displayed to save space. But of course, we can add it
with the appropriate option:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Previous graph + "other" column</span></span>
<span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="op">~</span> <span class="va">journal</span> <span class="op">|</span> <span class="va">institution</span>, <span class="va">us_pub_econ</span>, other <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; The 3 moderators were chosen based on frequency.</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>If you wish to select other moderator values, you can use
<code>mod.select</code> with regular expressions. Let’s have a look at
three Massachusetts institutions:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="op">~</span> <span class="va">journal</span> <span class="op">|</span> <span class="va">institution</span>, <span class="va">us_pub_econ</span>, mod.select <span class="op">=</span> <span class="st">"harvard|boston.+uni|mass.+inst"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="numeric-data">Numeric data<a class="anchor" aria-label="anchor" href="#numeric-data"></a>
</h3>
<p>Now let’s illustrate the behavior of the function in presence of
numerical data. We first import trade data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trade</span>, package <span class="op">=</span> <span class="st">"fixest"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Destination</th>
<th align="left">Origin</th>
<th align="right">Product</th>
<th align="right">Year</th>
<th align="right">dist_km</th>
<th align="right">Euros</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">1</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">2966697</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">1</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">6755030</td>
</tr>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">2</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">57078782</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">2</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">7117406</td>
</tr>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">3</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">17379821</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">3</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">2622254</td>
</tr>
</tbody>
</table>
<p>This data consists of importations between pairs of European
countries for different products across time. Let’s look at the
distribution of trade volume:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">trade</span><span class="op">$</span><span class="va">Euros</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>Three main things can be remarked. First, the data has been
automatically set to logarithmic form beforehand in order to offer a
better display. This behavior can be changed with the argument
<code>log</code>. Second, the first column contains all the leftovers
that are lower than 1,097 – this allows to focus on the part of the
graph where there is the most variation. This is why the graph does not
start from 0 but rather is focused on the mode of the distribution.
Thanks to this first column, there is no loss of information while
ensuring greater readability. Finally, the numeric scale is formatted
for an easy reading.</p>
<p>Now let’s look at the distribution of French and German exports:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Euros</span> <span class="op">|</span> <span class="va">Origin</span>, <span class="va">trade</span>, mod.select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DE"</span>, <span class="st">"FR"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>We use the argument <code>mod.select</code> to select the two
moderator values. For each logarithmic “bin”, the two moderators are
compared.</p>
<p>Now let’s look at another set of numeric data using the
<code>iris</code> data set.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Petal.Length</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>For “well distributed” continuous data, it looks very much like a
regular histogram, but a bit nicer. Note that the bin size is always
“discrete” to allow easy reading. Now we can also split the data by
species:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">|</span> <span class="va">Species</span>, <span class="va">iris</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Note that the full widths of the bins are reported in dashed lines,
so that the user does not confuse the size of the total bin with the
size of the bin for one single species.</p>
<p>Instead of displaying the three species on the same axis, we could
also choose to split the data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">|</span> <span class="va">Species</span>, <span class="va">iris</span>, mod.method <span class="op">=</span> <span class="st">"split"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>The full distribution of the three species are now separated.</p>
</div>
<div class="section level3">
<h3 id="stacking">Stacking<a class="anchor" aria-label="anchor" href="#stacking"></a>
</h3>
<p>Another way to display moderators is by stacking their values. Let’s
see the sepal length distribution by iris species:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">|</span> <span class="va">Species</span>, <span class="va">iris</span>, mod.method <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="cumulative-distribution">Cumulative distribution<a class="anchor" aria-label="anchor" href="#cumulative-distribution"></a>
</h3>
<p>To display the cumulative distribution, simply use the argument
<code>cumul = TRUE</code>. Let’s look at the cumulative distribution of
the top 5% publications:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">jnl_top_5p</span> <span class="op">~</span> <span class="va">institution</span>, <span class="va">us_pub_econ</span>, cumul <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>Just 10 institutions (the thick black line appears every five values)
account for 33% of all top 5% publications.</p>
</div>
</div>
<div class="section level2">
<h2 id="trends">Trends<a class="anchor" aria-label="anchor" href="#trends"></a>
</h2>
<p>You can also show the evolution of the aggregate of some variable
using the function <code>plot_lines</code>. By default, the function
applied by <code>plot_lines</code> is the average, but can be modified
at will. Let’s look at the evolution of the fraction of publications
published in top 5% journals:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_lines.html">plot_lines</a></span><span class="op">(</span><span class="va">jnl_top_5p</span> <span class="op">~</span> <span class="va">year</span>, <span class="va">us_pub_econ</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>The data is first aggregated at the year level,
i.e. <code>mean(us_pub_econ[year == YEAR, jnl_top_5p])</code> is applied
for each year, then a simple scatter plot is drawn.</p>
<p>As before, it is very easy to make the graph conditional. Let’s look
at the evolution for the three top institutions:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's find out the top 3/5 institutions in terms of production</span></span>
<span><span class="co"># we use plot_distr without plotting:</span></span>
<span><span class="va">info</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">us_pub_econ</span><span class="op">$</span><span class="va">institution</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">top3_instit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">info</span><span class="op">$</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">top5_instit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">info</span><span class="op">$</span><span class="va">x</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_lines.html">plot_lines</a></span><span class="op">(</span><span class="va">jnl_top_5p</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">institution</span>, </span>
<span>           <span class="va">us_pub_econ</span><span class="op">[</span><span class="va">institution</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top3_instit</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<p>If we want to display the conditional evolution of the frequencies
per year, we can use 1 as a variable, which will set the default
function to <code>sum</code> in order to get the frequencies:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_lines.html">plot_lines</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">institution</span>, <span class="va">us_pub_econ</span><span class="op">[</span><span class="va">institution</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top5_instit</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
<p>What can we remark from the previous graph? When the legend would not
fit in one line, the algorithm automatically adds one line to display
all the relevant information while using all the width of the graph for
readability.</p>
<p>We can add some simple smoothing with the option
<code>smoothing_window</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_lines.html">plot_lines</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">institution</span>, <span class="va">us_pub_econ</span><span class="op">[</span><span class="va">institution</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top5_instit</span><span class="op">]</span>, </span>
<span>           smoothing_window <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<p>The smoothing uses the n<span class="math inline">\(^{th}\)</span>
future and past years to smooth the data.</p>
</div>
<div class="section level2">
<h2 id="conditional-boxplot">Conditional boxplot<a class="anchor" aria-label="anchor" href="#conditional-boxplot"></a>
</h2>
<p>The function <code>plot_box</code> is made for conditional boxplots:
one variable conditionally to one or two moderators. Let’s have an
example with the publications data. First we create the number of
publications in top 5% journals per year and per institution, then we
display a yearly boxplot:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_pub</span> <span class="op">=</span> <span class="va">us_pub_econ</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>nb_pub_top_5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">jnl_top_5p</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                          by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">year</span>, <span class="va">institution</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/plot_box.html">plot_box</a></span><span class="op">(</span><span class="va">nb_pub_top_5</span> <span class="op">~</span> <span class="va">year</span>, <span class="va">base_pub</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>By default the outliers are not shown when the boxplots would
disappear because of the scale of the outliers. The means however are
displayed when the outliers are not, here it is represented by a red
diamond. We can see that while the 3rd quartile almost doubled in the
period, the mean almost trebled which means that the outliers gained
weight over time.</p>
<p>Now let’s redo the same analysis but by distinguishing the top 5
institutions from the rest:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_pub</span><span class="op">[</span>, <span class="va">isTop5</span> <span class="op">:=</span> <span class="va">institution</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top5_instit</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/plot_box.html">plot_box</a></span><span class="op">(</span><span class="va">nb_pub_top_5</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">isTop5</span>, <span class="va">base_pub</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p>Now the outliers are reported, to avoid this behavior, we can use the
argument <code>outlier = FALSE</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we also drop the mean</span></span>
<span><span class="fu"><a href="../reference/plot_box.html">plot_box</a></span><span class="op">(</span><span class="va">nb_pub_top_5</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">isTop5</span>, <span class="va">base_pub</span>, outlier <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>You can also plot several variables at once. Let’s take an example
using iris data:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_box.html">plot_box</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Species</span>, <span class="va">iris</span><span class="op">)</span></span></code></pre></div>
<p><img src="fplot_walkthrough_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>On the Microsoft Academic Graph data:</p>
<p>Arnab Sinha, Zhihong Shen, Yang Song, Hao Ma, Darrin Eide, Bo-June
(Paul) Hsu, and Kuansan Wang. 2015. An Overview of Microsoft Academic
Service (MAS) and Applications. In Proceedings of the 24th International
Conference on World Wide Web (WWW 15 Companion). ACM, New York, NY, USA,
243-246. DOI=<a href="http://dx.doi.org/10.1145/2740908.2742839" class="external-link uri">http://dx.doi.org/10.1145/2740908.2742839</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
